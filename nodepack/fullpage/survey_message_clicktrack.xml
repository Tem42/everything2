<node>
  <type_nodetype>451267</type_nodetype>
  <doctext>[%

my $ip = $ENV{HTTP_X_FORWARDED_FOR};

my $fromnode = $query-&gt;param('fromnode');
$fromnode ||= $$NODE{node_id};

$DB-&gt;sqlInsert(&quot;surveyclicks&quot;, { userip =&gt; $ip, -clicktime =&gt; &quot;now()&quot;, fromnode =&gt; $fromnode });

&quot;&quot;;
%]
&lt;html&gt;
&lt;head&gt;
&lt;script&gt;
  var exdate=new Date();
  exdate.setDate(exdate.getDate()+800);
  var surveyexpires = &quot;expires=&quot;+exdate.toGMTString();
  document.cookie='surveyview=1; '+surveyexpires+'; path=/';
  window.location = &quot;[% 
  my $N = getNode('survey message settings','setting');
  my $CONF = getVars($N);

  return $$CONF{survey_target};
%]&quot;;
&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;&lt;a href=&quot;[% 
  my $N = getNode('survey message settings','setting');
  my $CONF = getVars($N);

  return $$CONF{survey_target};
%]&quot;&gt;Click here if your browser does not redirect&lt;/a&gt;&lt;/body&gt;
&lt;/html&gt;</doctext>
  <node_id>1995283</node_id>
  <title>survey message clicktrack</title>
</node>

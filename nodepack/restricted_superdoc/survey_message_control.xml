<node>
  <doctext>&lt;h3&gt;Relevant Links&lt;/h3&gt;
[%

my @links = ();
push @links, getNode('survey message settings', 'setting');
push @links, getNode('surveymessage', 'htmlcode');
push @links, getNode('survey message clicktrack', 'fullpage');
push @links, getNode('surveyclicks', 'dbtable');

return join &quot;&quot;, map { &quot;&lt;li&gt;&quot;. linkNode($_). &quot; (&quot; . $_-&gt;{type}{title} . &quot;)&quot;  } @links;

%]
&lt;h3&gt;Survey Message Preview:&lt;/h3&gt;
[{surveymessage:1}]

&lt;h3&gt;Survey Message Client Check&lt;/h3&gt;
[%

my $user = $ENV{HTTP_X_FORWARDED_FOR};

if ($query-&gt;cookie('surveyview') == -1) {
 return &quot;$user has declined survey&quot;;
}elsif ($query-&gt;cookie('surveyview') == 1) {
 return &quot;$user has clicked on survey&quot;;
} else {
 return &quot;$user has not interacted with survey message&quot;;
}

%]

&lt;h3&gt;Survey Clickthrus&lt;/h3&gt;
[%
my $str = &quot;&quot;;
my $csr = $DB-&gt;sqlSelectMany(&quot;*&quot;, &quot;surveyclicks&quot;);

$str .= &quot;&lt;table border=1&gt;&lt;tr&gt;&lt;th&gt;IP&lt;/th&gt;&lt;th&gt;Time&lt;/th&gt;&lt;th&gt;From Node&lt;/th&gt;&lt;/tr&gt;&quot;;
while (my $row = $csr-&gt;fetchrow_hashref()) {
  $str .= &quot;&lt;tr&gt;&lt;td&gt;&quot;.$$row{userip}.&quot;&lt;/td&gt;&lt;td&gt;&quot;.$$row{clicktime}.&quot;&lt;/td&gt;&lt;td&gt;&quot;.$$row{fromnode}.&quot;&lt;/td&gt;&lt;/tr&gt;&quot;;
}
$csr-&gt;finish();
$str .= &quot;&lt;/table&gt;&quot;;

return $str;
%]</doctext>
  <node_id>1995272</node_id>
  <type_nodetype>13</type_nodetype>
  <title>survey message control</title>
</node>

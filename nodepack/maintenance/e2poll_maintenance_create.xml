<node>
  <type_nodetype>150</type_nodetype>
  <maintain_nodetype>1685242</maintain_nodetype>
  <node_id>1685267</node_id>
  <title>e2poll maintenance create</title>
  <maintaintype>create</maintaintype>
  <code>my ( $POLL ) = @_;

getRef( $POLL );

unless ($$POLL{title} &amp;&amp; $query -&gt; param('e2poll_question')) {
	nukeNode($POLL, -1);
	$query -&gt; param('node_id', getId(getNode('Everything Poll Creator', 'superdoc')));
	return;
}

$$POLL{poll_author}=$$POLL{author_user};
$$POLL{author_user} = getId(getNode('Content Editors', 'usergroup'));

# this node no longer belongs to its author. So if the author is a normal user, they can't update it any more
# so e2poll_question will get lost. So:
$$POLL{question} = $query -&gt; param('e2poll_question');

my @doctext = ();
$$POLL{e2poll_results} = 0;

for (1 .. 12){
	if (my $queryVal = $query-&gt;param(&quot;option$_&quot;)){
		push @doctext, $queryVal;
		$$POLL{e2poll_results} .= ',0';
	}
};

push @doctext, 'None of the above';
$$POLL{doctext} = join &quot;\n\n&quot;, @doctext;
$$POLL{poll_status} = 'new';

updateNode( $POLL, -1 );
</code>
</node>

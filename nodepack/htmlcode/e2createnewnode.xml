<node>
  <type_nodetype>4</type_nodetype>
  <delegate_to></delegate_to>
  <node_id>175616</node_id>
  <title>e2createnewnode</title>
  <code>my $title = $query-&gt;param('node');

#Don't allow creation of nodes that begin with http(s)://
$title =~ s/^\s*https?:\/\///;

return '' unless $title;

return '&lt;p&gt;If you '
	.linkNode(getNode(&quot;login&quot;,&quot;superdoc&quot;), 'Log in')
	.' you could create a &quot;'
	.$query -&gt; escapeHTML($title)
	.&quot;\&quot; node.	If you don't already have an account, you can &quot;
	. linkNode($Everything::CONF-&gt;{system}-&gt;{create_new_user}, 'register here')
	.'.' if $APP-&gt;isGuest($USER);

my $n = getNode($title, 'e2node');
return '&lt;p&gt;'.linkNode($n).' already exists.&lt;/p&gt;' if $n;

my $str = '&lt;p&gt;Since we didn\'t find what you were looking for, you
	can search again, or create a new draft or e2node (page):
	&lt;/p&gt;'
	.$query -&gt; start_form(-method =&gt; 'get', action =&gt; '/')
	.'&lt;fieldset&gt;
	&lt;legend&gt;Search again&lt;/legend&gt;'
	.$query -&gt; textfield(
		-name =&gt; 'node',
		size =&gt; 50,
		maxlength =&gt; 100
	)
	.' '
	.$query -&gt; hidden('lastnode_id')
	.$query -&gt; submit('searchy', 'search')
	.'&lt;br&gt;'
	.$query -&gt; checkbox(
		-name =&gt; 'soundex',
		value =&gt; 1,
		label =&gt; 'Near Matches '
	)
	.$query -&gt; checkbox(
		-name =&gt; 'match_all',
		value =&gt; 1,
		label =&gt; 'Ignore Exact'
	)
	.'&lt;/fieldset&gt;&lt;/form&gt;'
	.$query -&gt; start_form(-method =&gt; 'get', action =&gt; '/')
	.'&lt;fieldset&gt;
	&lt;legend&gt;Create new...&lt;/legend&gt;
	&lt;small&gt;You can correct the spelling or capitalization here.&lt;/small&gt;
	&lt;br&gt;'
	.$query -&gt; textfield(
		-name =&gt; 'node',
		size =&gt; 50,
		maxlength =&gt; 100
	)
	.$query -&gt; hidden('lastnode_id')
	.$query -&gt; hidden(-name =&gt; 'op', value =&gt; 'new', -force =&gt; 1)
	.' &lt;button type=&quot;submit&quot; name=&quot;type&quot; value=&quot;draft&quot;&gt;New draft&lt;/button&gt;
	&lt;button type=&quot;submit&quot; name=&quot;type&quot; value=&quot;e2node&quot;&gt;New node&lt;/button&gt;';

if ($APP-&gt;isAdmin($USER)){
	$str .= '&lt;p&gt;Lucky you, you can &lt;strong&gt;'
	.linkNode(getNode('create node', 'restricted_superdoc'),
		'create any type of node...', {newtitle =&gt; $title})
		.'&lt;/strong&gt;&lt;/p&gt;';
}

$str .= '&lt;/fieldset&gt;&lt;/form&gt;';

if ($APP-&gt;isEditor($USER)){
	$str .= &quot;&lt;p&gt;If you wish to exercise your Editorial Power to create a [document[nodetype]], create a draft, click on the 'Advanced option(s)' button, and then use the nice shiny 'Publish as document' button provided for this purpose.&lt;/p&gt;&quot;;
}

$str;
</code>
</node>

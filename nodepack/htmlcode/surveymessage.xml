<node>
  <node_id>1995277</node_id>
  <code>my ($previewmode) = @_;
#opt out if nodetype is not doc/superdoc/e2node/writeup

my $N = getNode('survey message settings','setting');

my $CONF = getVars($N);

if (not $previewmode and not $$CONF{enabled}) { return &quot;&quot;; }


my $link = linkNode($$CONF{clicktrack_rawdata}, $$CONF{survey_message}, { fromnode =&gt; $$NODE{node_id} });

my $hidethis = &lt;&lt;HIDEJAVASCRIPT;
&lt;script&gt;
 if (document.cookie.indexOf(&quot;surveyview&quot;) != -1) {
   document.getElementById('surveymessage').style.display = 'none';
 }
&lt;/script&gt;

HIDEJAVASCRIPT

if ($previewmode) { $hidethis = &quot;&quot;; }

return &lt;&lt;MSGHTML
&lt;script&gt;
  var exdate=new Date();
  exdate.setDate(exdate.getDate()+800);
  var surveyexpires = &quot;expires=&quot;+exdate.toGMTString();
&lt;/script&gt;

&lt;div style=&quot;$$CONF{styles}&quot; id=&quot;surveymessage&quot;&gt;
$link&lt;br&gt;
(&lt;a onmouseup=&quot;document.cookie='surveyview=-1; '+surveyexpires+'; path=/'; document.getElementById('surveymessage').style.display = 'none';  1;&quot; href=&quot;#&quot;&gt;$$CONF{survey_decline}&lt;/a&gt;)
&lt;/div&gt;
$hidethis

MSGHTML
</code>
  <type_nodetype>4</type_nodetype>
  <title>surveymessage</title>
</node>
